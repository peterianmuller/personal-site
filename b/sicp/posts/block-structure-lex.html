<!DOCTYPE html>
<html>
<head>
</head>

<body>

<h1>Block Structure and Lexical Scoping</h1>
<p>We've looked at incremental construction of of our square root procedure by using various auxilar procedures toegether to accomplish the larger task of finding the square root of a number x.</p>
<p>However our current incarnation of sqrt is a smattering of auxiliar procedures, some of which really might only be relevant to sqrt.</p>


<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">square</span> <span style="color: #B8860B">x</span>)
  (<span style="color: #AA22FF">* </span><span style="color: #B8860B">x</span> <span style="color: #B8860B">x</span>))

(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">sqrt-iter</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
  (<span style="color: #AA22FF; font-weight: bold">if </span>(<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
      <span style="color: #B8860B">guess</span>
      (<span style="color: #00A000">sqrt-iter</span> (<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>) <span style="color: #B8860B">x</span>)))

(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
  (<span style="color: #00A000">average</span> <span style="color: #B8860B">guess</span> (<span style="color: #AA22FF">/ </span><span style="color: #B8860B">x</span> <span style="color: #B8860B">guess</span>)))


(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">average</span> <span style="color: #B8860B">x</span> <span style="color: #B8860B">y</span>)
  (<span style="color: #AA22FF">/ </span>(<span style="color: #AA22FF">+ </span><span style="color: #B8860B">x</span> <span style="color: #B8860B">y</span>) <span style="color: #666666">2</span>))


(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
  ( <span style="color: #B8860B">&lt;</span> (<span style="color: #AA22FF">abs </span>( <span style="color: #B8860B">-</span> (<span style="color: #00A000">square</span> <span style="color: #B8860B">guess</span>) <span style="color: #B8860B">x</span>)) <span style="color: #666666">0.001</span>))


(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #AA22FF">sqrt </span><span style="color: #B8860B">x</span>)
  (<span style="color: #00A000">sqrt-iter</span> <span style="color: #666666">1.0</span> <span style="color: #B8860B">x</span>))

(<span style="color: #AA22FF">sqrt </span><span style="color: #666666">5</span>)
</pre>



<p>However our current incarnation of sqrt is a smattering of auxiliar procedures, some of which really might only be relevant to sqrt. Let's say we have another program that needs to use a different procedure to perform successive approximations. Becuase we are perfoming &quot;procedural epistemology&quot;, we might want to call our other successive approximation procedure good-enough? We can't have a single name point to two distinct procedures (38). In order to avoid this pollution of the enviornemt with repeated names of distinct procedures, we can define procedures relevant to sqrt within the body of sqrt, thereby binding these names to the body of sqrt. We can thus have another function that requires a different good-enough? (such as cube-root) that is bound to that function. Each good-enough? should not know about each other yet co-exist.</p>

<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">sqrt-block</span> <span style="color: #B8860B">x</span>)
  (<span style="color: #AA22FF; font-weight: bold">define </span> (<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
    (<span style="color: #AA22FF">&lt; </span>(<span style="color: #AA22FF">abs </span>(<span style="color: #AA22FF">- </span>(<span style="color: #00A000">square</span> <span style="color: #B8860B">guess</span>) <span style="color: #B8860B">x</span>)) <span style="color: #666666">0.001</span>))
  (<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>) (<span style="color: #00A000">average</span> <span style="color: #B8860B">guess</span> (<span style="color: #AA22FF">/ </span><span style="color: #B8860B">x</span> <span style="color: #B8860B">guess</span>)))
  (<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">sqrt-iter</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
    (<span style="color: #AA22FF; font-weight: bold">if </span>(<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>)
        <span style="color: #B8860B">guess</span>
        (<span style="color: #00A000">sqrt-iter</span> (<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span> <span style="color: #B8860B">x</span>) <span style="color: #B8860B">x</span>)))
  (<span style="color: #00A000">sqrt-iter</span> <span style="color: #666666">1.0</span> <span style="color: #B8860B">x</span>))
(<span style="color: #00A000">sqrt-block</span> <span style="color: #666666">5</span>)
</pre>



<p>Above, x is bound to the definition of sqrt. Also, because we're using bracket structure, the procedures defind within sqrt good-enough?, improve, and sqrt-iter are all bound to the definition of sqrt.</p>
<p>&quot;Since x is bound in the definition of sqrt, the procedures good-enough?, improve, and sqrt-iter, which are defined internally are in the scope of x. Thus it is not necessary to pass x explicetly to each of these procedures. Instead, we allow x to be a free variable in the internal definitions as shown below&quot; (39).</p>
<p>For the internal definitions, x is a free variable, thus a value that is determined elsewhere, as abs and square are. In this case, x is defined as the formal paramter for the parent function, but in all places in scope is set to that value. We don't ever want to change x from the value set in formal parameters of sqrt.</p>
<p>So we can remove x from the parameters of the internal functions. good-enough?, improve, sqrt-iter all can reason about x without x being declared as a formal parameter to those procedures.</p>
<p>This process is called &quot;lexical scoping&quot; (39). All internal procedures can reason about thier parent's formal parameters. In fact, those formal parameters become free variables, set just as primitive operators, square, abs etc. In this case x is a bound variable when passed into sqrt, but then becomes a free variable for the invocations of the sub-procedures that are within the body of sqrt.</p>

<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">(<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">sqrt-lex</span> <span style="color: #B8860B">x</span>)
  (<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span>)
    (<span style="color: #AA22FF">&lt; </span>( <span style="color: #B8860B">abs</span> (<span style="color: #AA22FF">- </span>(<span style="color: #00A000">square</span> <span style="color: #B8860B">guess</span>) <span style="color: #B8860B">x</span>)) <span style="color: #666666">0.001</span>))
  (<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span>)
    (<span style="color: #00A000">average</span> <span style="color: #B8860B">guess</span> (<span style="color: #AA22FF">/ </span><span style="color: #B8860B">x</span> <span style="color: #B8860B">guess</span>)))
  (<span style="color: #AA22FF; font-weight: bold">define </span>(<span style="color: #00A000">sqrt-iter</span> <span style="color: #B8860B">guess</span>)
    (<span style="color: #AA22FF; font-weight: bold">if </span>(<span style="color: #00A000">good-enough?</span> <span style="color: #B8860B">guess</span>)
        <span style="color: #B8860B">guess</span>
        (<span style="color: #00A000">sqrt-iter</span> (<span style="color: #00A000">improve</span> <span style="color: #B8860B">guess</span>))))
  (<span style="color: #00A000">sqrt-iter</span> <span style="color: #666666">1.0</span>))

(<span style="color: #00A000">sqrt-lex</span> <span style="color: #666666">5</span>)

(<span style="color: #AA22FF">= </span>(<span style="color: #00A000">sqrt-block</span> <span style="color: #666666">5</span>) (<span style="color: #00A000">sqrt-lex</span>))
</pre>

<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%"><span style="color: #880000">#t</span>
</pre>



</body>
</html>
